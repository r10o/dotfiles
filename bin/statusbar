#!/usr/bin/sh

# Colors
grey="^fg()"
white="^fg(#ffffff)"
green="^fg(#44cc44)"
yellow="^fg(#ff995c)"
cyan="^fg(#6096bf)"
magenta="^fg(#7E62B3)"
red="^fg(#e33333)"

# Counter
count="0"

# Constants
icon_dir="/home/rohan/pics/xbmicons/"

# Icons
note="^i(${icon_dir}note.xbm)"

volume100="^i(${icon_dir}volume100.xbm)"
volume75="^i(${icon_dir}volume75.xbm)"
volume50="^i(${icon_dir}volume50.xbm)"
volume25="^i(${icon_dir}volume25.xbm)"
volume0="^i(${icon_dir}volume0.xbm)"

wireless1="^i(${icon_dir}wireless1.xbm)"
wireless2="^i(${icon_dir}wireless2.xbm)"
wireless3="^i(${icon_dir}wireless3.xbm)"
wireless4="^i(${icon_dir}wireless4.xbm)"
wireless5="^i(${icon_dir}wireless5.xbm)"

net_up="^i(${icon_dir}net_up_03.xbm)"
net_down="^i(${icon_dir}net_down_03.xbm)"

battery10="^i(${icon_dir}battery10.xbm)"
battery20="^i(${icon_dir}battery20.xbm)"
battery30="^i(${icon_dir}battery30.xbm)"
battery40="^i(${icon_dir}battery40.xbm)"
battery50="^i(${icon_dir}battery50.xbm)"
battery60="^i(${icon_dir}battery60.xbm)"
battery70="^i(${icon_dir}battery70.xbm)"
battery80="^i(${icon_dir}battery80.xbm)"
battery90="^i(${icon_dir}battery90.xbm)"

grid="^i(${icon_dir}grid.xbm)"

clock="^i(${icon_dir}clock.xbm)"

getMpd() {
	running="$(ps aux | grep '[\d] mpd')"
	message=""
	color=""

	if [ "$running" == "" ]; then
		color=${red}
		message="stopped"
	else
		title="$(ncmpcpp --now-playing | sed 's|.*[)-] \(.*\)|\1|')"
		if [ "$title" == "" ]; then
			color=${red}
			message="stopped"
		else
			color=${cyan}
			message=${title}
		fi
	fi

	echo -ne "${color}${note} ${grey}${message}"
}

getVolume() {
	mute="$(amixer get Master | sed '1,4d;s|.*\[\(.*\)\]$|\1|')"
	volume=""
        color=""

        if [ $mute == "off" ]; then
                volume="0"
                color="${red}"
	elif [ $mute == "on" ]; then
		volume="$(amixer get Master | sed '1,4d;s|.*\[\(.*\)%\].*|\1|')"
		if [ $volume -eq 0 ]; then
			icon="${volume0}"
			color="${red}"
		elif [ $volume -le 25 ]; then
			icon="${volume25}"
			color="${cyan}"
		elif [ $volume -le 50 ]; then
			icon="${volume50}"
			color="${cyan}"
		elif [ $volume -le 75 ]; then
			icon="${volume75}"
			color="${cyan}"
		else
			icon="${volume100}"
			color=${cyan}
		fi
	fi

        echo -ne "${color}${icon} ${grey}${volume}%"
}

getNet() {
        current="$(netcfg current)"
	
	if [[ $current == 'usb' ]]; then
		icon=${net_up}
	else
		quality="$(cat /proc/net/wireless | sed '1,2d;s|.*\s\([0-9]*\)\..*|\1|')"
		if [[ $quality -le 14 ]]; then
			icon=${wireless1}
		elif [[ $quality -le 28 ]]; then
			icon=${wireless2}
		elif [[ $quality -le 42 ]]; then
			icon=${wireless3}
		elif [[ $quality -le 56 ]]; then
			icon=${wireless4}
		elif [[ $quality -le 70 ]]; then
			icon=${wireless5}
		fi
	fi

        if [ $current ]; then
                echo -ne "${cyan}${icon} ${grey}${current}"
        else
                icon=${net_down}
                echo -ne "${red}${icon} ${grey}dis"
        fi
}

getBattery() {
	level="$(acpi | sed 's|.* \([0-9]*\)%.*|\1|')"
	charging="$(acpi | sed 's|.*: \([A-Za-z]*\).*|\1|')"
        color=${cyan}

        if [ ${charging} == "Charging" ]; then
		case ${1} in
			"0")
				icon=${battery10}
				;;
			"1")
			        icon=${battery20}
			        ;;
			"2")
			        icon=${battery30}
			        ;;
			"3")
			        icon=${battery40}
			        ;;
			"4")
			        icon=${battery50}
			        ;;
			"5")
			        icon=${battery60}
			        ;;
			"6")
			        icon=${battery70}
			        ;;
			"7")
			        icon=${battery80}
			        ;;
			"8")
				icon=${battery90}
				;;
		esac
        else
                if [ ${level} -le 12 ]; then
                        color=${red}
                        icon=${battery10}
                elif [ ${level} -le 23 ]; then
                        color=${red}
                        icon=${battery20}
                elif [ ${level} -le 34 ]; then
                        color=${yellow}
                        icon=${battery30}
                elif [ ${level} -le 45 ]; then
                        color=${yellow}
                        icon=${battery40}
                elif [ ${level} -le 56 ]; then
                        color=${yellow}
                        icon=${battery50}
                elif [ ${level} -le 67 ]; then
                        icon=${battery60}
                elif [ ${level} -le 78 ]; then
                        icon=${battery70}
                elif [ ${level} -le 89 ]; then
                        icon=${battery80}
                else
                        icon=${battery90}
                fi
        fi

        echo -ne "${color}${icon} ${grey}${level}%"
}

getDate() {
	icon=${grid}
	echo -ne "${cyan}${icon} ${grey}$(date "+%B %e, %Y")"
}

getTime() {
	icon=${clock}
        echo -ne "${cyan}${clock} ${grey}$(date "+%I:%M %p")"
}

getWorkspaces() {
	echo ""
}

while true; do
	echo -e "$(getMpd)  $(getVolume)  $(getBattery $count)  $(getNet)  $(getDate)  $(getTime) "
	if [[ ${count} < "8" ]]; then
		((count++))
	else
		count="0"
	fi
	sleep 1
done
