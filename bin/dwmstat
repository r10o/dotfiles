#!/bin/sh

grey="\x01"
white="\x02"
green="\x04"
yellow="\x05"
cyan="\x06"
magenta="\x07"
red="\x08"

getMpd() {
        title="$(ncmpcpp --now-playing | cut -d "-" -f2-)"
        other="$(ncmpcpp --now-playing | cut -d " " -f2)"
	if [[ $other == "connect" || $other == "" ]]; then
                echo -ne "${red}\uE05C${grey} stopped" 
	elif [[ $title ]]; then
                echo -ne "${cyan}\uE05C${grey}  ${title}"
        fi
}

getVolume() {
        volume="$(amixer get Master | tail -n1 | sed -r 's/.*\[(.*)%\].*/\1/')"
        mute="$(amixer get Master | tail -n1 | awk '{print $6}')"
        color=""

        if [ $mute == "[off]" ]; then
                volume="0"
                color="${red}"
        fi

        if [ $volume -eq 0 ]; then
                icon="\uE04F"
                color="${red}"
        elif [ $volume -le 33 ]; then
                icon="\uE04E"
                color="${cyan}"
        elif [ $volume -le 66 ]; then
                icon="\uE050"
                color="${cyan}"
        else
                icon="\uE05D"
                color="${cyan}"
        fi

        echo -ne "${color}${icon}${grey}  ${volume}%"

}

getNet() {
        current="$(netcfg current)"
	
	if [[ $current == 'usb' ]]; then
		icon="\uE11f"
	else
		quality="$(cat /proc/net/wireless | tail -n1 | awk '{ print $3 }' | cut -d "." -f1)"
		if [[ $quality -le 35 ]]; then
			icon="\uE047"
		elif [[ $quality -le 70 ]]; then
			icon="\uE048"
		fi
	fi

        if [ $current ]; then
                echo -ne "${cyan}${icon}${grey}  ${current}"
        else
                icon="\uE09F"
                echo -ne "${red}${icon}${grey}  dis"
        fi
}

getBattery() {
        level="$(acpi | grep -i battery | awk '{ print $4 }' | cut -d '%' -f1)"
        charging="$(acpi | grep -i battery | awk '{ print $3 }' | cut -d ',' -f1)"
        color=$cyan

        if [ $charging == "Full" ]; then
                icon="\uE042"
        elif [ $charging == "Charging" ]; then
                icon="\uE040"
        else
                if [ $level -le 25 ]; then
                        color=$red
                        icon="\uE030"
                elif [ $level -le 50 ]; then
                        color=$yellow
                        icon="\uE031"
                elif [ $level -le 75 ]; then
                        icon="\uE032"
                else
                        icon="\uE033"
                fi
        fi
        echo -ne "${color}${icon}${grey}  ${level}%"
}

getDate() {
	echo -ne "${cyan}\uE01F${grey}  $(date "+%B %e, %Y")"
}

getTime() {
        echo -ne "${cyan}\uE015${grey}  $(date "+%I:%M %p")   ${cyan}\uE00E"
}

while true; do
	xsetroot -name "$(getMpd)   $(getVolume)   $(getBattery)   $(getNet)   $(getDate)   $(getTime)   " 
        sleep 1
done
